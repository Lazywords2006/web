# è®¸å¯è¯ç®¡ç†ç³»ç»Ÿ - é›†æˆæŒ‡å—

## ğŸ“¦ å®Œæ•´ç»„ä»¶è¯´æ˜

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ª**å®Œæ•´çš„è®¸å¯è¯ç®¡ç†è§£å†³æ–¹æ¡ˆ**,åŒ…å«:
- âœ… Go åç«¯æœåŠ¡å™¨ (RESTful API)
- âœ… Web ç®¡ç†åå°ç•Œé¢
- âœ… ç™»å½•è®¤è¯ç³»ç»Ÿ
- âœ… è®¸å¯è¯å¢åˆ æ”¹æŸ¥
- âœ… è®¾å¤‡æ¿€æ´»ç®¡ç†
- âœ… ç»Ÿè®¡ä»ªè¡¨ç›˜

---

## ğŸ¯ é›†æˆåœºæ™¯

### åœºæ™¯ 1: ç‹¬ç«‹ä½¿ç”¨ (æ¨è)
é€‚åˆ: éœ€è¦å®Œæ•´çš„è®¸å¯è¯ç®¡ç†ç³»ç»Ÿ

```
ä½ çš„é¡¹ç›®/
â”œâ”€â”€ server/          # è®¸å¯è¯æœåŠ¡å™¨ (å·²å®Œæˆ)
â”‚   â”œâ”€â”€ main.go
â”‚   â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ frontend/    # Web ç®¡ç†ç•Œé¢
â”‚   â””â”€â”€ licenses.db
â””â”€â”€ ä½ çš„åº”ç”¨ç¨‹åº/     # è°ƒç”¨è®¸å¯è¯ API
```

**ä¼˜ç‚¹**: åŠŸèƒ½å®Œæ•´,å¼€ç®±å³ç”¨
**éƒ¨ç½²**: ç›´æ¥æŒ‰ç…§ä¸‹é¢çš„"ç‹¬ç«‹éƒ¨ç½²"æ­¥éª¤æ“ä½œ

---

### åœºæ™¯ 2: é›†æˆåˆ°ç°æœ‰ Go é¡¹ç›®
é€‚åˆ: ä½ æœ‰ä¸€ä¸ªç°æœ‰çš„ Go é¡¹ç›®,æƒ³æ·»åŠ è®¸å¯è¯åŠŸèƒ½

#### æ­¥éª¤:

**1. å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶åˆ°ä½ çš„é¡¹ç›®**

```bash
cd /path/to/your/project

# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p license/{handlers,models,database,utils,frontend}

# å¤åˆ¶åç«¯ä»£ç 
cp /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/handlers/*.go license/handlers/
cp /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/models/*.go license/models/
cp /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/database/*.go license/database/
cp /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/utils/*.go license/utils/

# å¤åˆ¶å‰ç«¯ç•Œé¢
cp -r /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/frontend/* license/frontend/
```

**2. ä¿®æ”¹ä½ çš„ main.go**

```go
package main

import (
    "log"
    "net/http"

    // å¯¼å…¥è®¸å¯è¯æ¨¡å—
    "yourproject/license/database"
    "yourproject/license/handlers"
)

func main() {
    // åˆå§‹åŒ–è®¸å¯è¯æ•°æ®åº“
    if err := database.InitDB("./licenses.db"); err != nil {
        log.Fatal(err)
    }
    defer database.Close()

    // ä½ çš„åŸæœ‰è·¯ç”±
    http.HandleFunc("/", yourHandler)

    // æ·»åŠ è®¸å¯è¯ API è·¯ç”±
    http.HandleFunc("/api/activate", handlers.HandleActivate)
    http.HandleFunc("/api/heartbeat", handlers.HandleHeartbeat)
    http.HandleFunc("/api/admin/license", handlers.HandleAdminLicense)
    http.HandleFunc("/api/admin/licenses", handlers.HandleListLicenses)
    http.HandleFunc("/api/admin/stats", handlers.HandleGetStats)

    // å‰ç«¯é™æ€æ–‡ä»¶
    fs := http.FileServer(http.Dir("./license/frontend"))
    http.Handle("/license/", http.StripPrefix("/license/", fs))

    log.Println("Server running on :8080")
    http.ListenAndServe(":8080", nil)
}
```

**3. æ›´æ–° go.mod ä¾èµ–**

```bash
go get github.com/mattn/go-sqlite3
go mod tidy
```

**4. è®¿é—®ç®¡ç†ç•Œé¢**

```
http://localhost:8080/license/login.html
```

---

### åœºæ™¯ 3: ä»…ä½¿ç”¨ API (æ— ç•Œé¢)
é€‚åˆ: ä½ åªéœ€è¦åç«¯ API,è‡ªå·±å®ç°å‰ç«¯

#### æ­¥éª¤:

**1. å¯åŠ¨è®¸å¯è¯æœåŠ¡å™¨**

```bash
cd /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server
go run main.go
```

**2. åœ¨ä½ çš„åº”ç”¨ä¸­è°ƒç”¨ API**

```javascript
// ç¤ºä¾‹: æ¿€æ´»è®¸å¯è¯
const response = await fetch('http://localhost:8080/api/activate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        license_key: "LICENSE-2025-XXXXX",
        hwid: "UNIQUE-DEVICE-ID"
    })
});

const result = await response.json();
if (result.success) {
    console.log('æ¿€æ´»æˆåŠŸ:', result);
}
```

**3. API æ–‡æ¡£**

æŸ¥çœ‹å®Œæ•´ API æ–‡æ¡£: `/Users/lazywords/Documents/ç½‘ç»œéªŒè¯/README.md`

---

## ğŸš€ ç‹¬ç«‹éƒ¨ç½²æ­¥éª¤

### æœ¬åœ°å¼€å‘

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server

# 2. å®‰è£…ä¾èµ–
go mod download

# 3. è¿è¡ŒæœåŠ¡å™¨
go run main.go

# 4. è®¿é—®ç®¡ç†ç•Œé¢
# http://localhost:8080/login.html
# ç”¨æˆ·å: lazywords
# å¯†ç : w7168855
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# 1. ç¼–è¯‘
go build -o server main.go

# 2. å¯åŠ¨æœåŠ¡
nohup ./server > server.log 2>&1 &

# 3. æ£€æŸ¥æ—¥å¿—
tail -f server.log
```

---

## ğŸ“‚ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### å¿…éœ€æ–‡ä»¶ (åç«¯)

```
server/
â”œâ”€â”€ main.go                    # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ admin.go              # ç®¡ç† API (å¢åˆ æ”¹æŸ¥ã€ç»Ÿè®¡)
â”‚   â””â”€â”€ license.go            # è®¸å¯è¯ API (æ¿€æ´»ã€éªŒè¯)
â”œâ”€â”€ database/
â”‚   â””â”€â”€ db.go                 # æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ models/
â”‚   â””â”€â”€ models.go             # æ•°æ®æ¨¡å‹
â””â”€â”€ utils/
    â””â”€â”€ utils.go              # å·¥å…·å‡½æ•°
```

### å‰ç«¯ç•Œé¢ (å¯é€‰)

```
frontend/
â”œâ”€â”€ login.html                # ç™»å½•é¡µé¢
â”œâ”€â”€ index.html                # ç®¡ç†åå°ä¸»é¡µ
â”œâ”€â”€ test.html                 # API æµ‹è¯•é¡µé¢
â””â”€â”€ welcome.html              # æ¬¢è¿é¡µé¢
```

---

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### 1. ä¿®æ”¹ç™»å½•è´¦å·

ç¼–è¾‘ `frontend/login.html`:

```javascript
const validUsers = {
    'admin': 'your_password',      // æ·»åŠ ä½ çš„è´¦å·
    'lazywords': 'w7168855'
};
```

### 2. ä¿®æ”¹æ•°æ®åº“è·¯å¾„

ç¼–è¾‘ `main.go`:

```go
database.InitDB("./data/licenses.db")  // è‡ªå®šä¹‰è·¯å¾„
```

### 3. ä¿®æ”¹ç«¯å£

ç¼–è¾‘ `main.go`:

```go
http.ListenAndServe(":9000", nil)  // æ”¹ä¸ºå…¶ä»–ç«¯å£
```

### 4. æ·»åŠ  HTTPS

```go
http.ListenAndServeTLS(":443", "cert.pem", "key.pem", nil)
```

---

## ğŸ”Œ å®¢æˆ·ç«¯é›†æˆç¤ºä¾‹

### C# å®¢æˆ·ç«¯

```csharp
using System.Net.Http;
using System.Text.Json;

public class LicenseClient
{
    private readonly HttpClient _client;

    public LicenseClient(string serverUrl)
    {
        _client = new HttpClient { BaseAddress = new Uri(serverUrl) };
    }

    public async Task<bool> ActivateLicense(string key, string hwid)
    {
        var data = new { license_key = key, hwid = hwid };
        var json = JsonSerializer.Serialize(data);
        var content = new StringContent(json, Encoding.UTF8, "application/json");

        var response = await _client.PostAsync("/api/activate", content);
        var result = await response.Content.ReadAsStringAsync();

        return response.IsSuccessStatusCode;
    }
}
```

### Python å®¢æˆ·ç«¯

```python
import requests

class LicenseClient:
    def __init__(self, server_url):
        self.base_url = server_url

    def activate_license(self, license_key, hwid):
        url = f"{self.base_url}/api/activate"
        data = {
            "license_key": license_key,
            "hwid": hwid
        }
        response = requests.post(url, json=data)
        return response.json()

# ä½¿ç”¨
client = LicenseClient("http://localhost:8080")
result = client.activate_license("LICENSE-2025-XXX", "device-id")
```

### JavaScript å®¢æˆ·ç«¯

```javascript
class LicenseClient {
    constructor(serverUrl) {
        this.baseUrl = serverUrl;
    }

    async activateLicense(licenseKey, hwid) {
        const response = await fetch(`${this.baseUrl}/api/activate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                license_key: licenseKey,
                hwid: hwid
            })
        });
        return await response.json();
    }
}

// ä½¿ç”¨
const client = new LicenseClient('http://localhost:8080');
const result = await client.activateLicense('LICENSE-2025-XXX', 'device-id');
```

---

## ğŸ“Š æ•°æ®åº“ç»“æ„

```sql
-- licenses è¡¨
CREATE TABLE licenses (
    id INTEGER PRIMARY KEY,
    license_key TEXT UNIQUE NOT NULL,
    product_name TEXT,
    hwid TEXT,
    status TEXT,                -- active, unused, expired, banned
    max_devices INTEGER,
    expires_at DATETIME,
    activated_at DATETIME,
    created_at DATETIME,
    updated_at DATETIME,
    user_id INTEGER,
    order_id TEXT,
    last_heartbeat DATETIME
);

-- activation_logs è¡¨ (æ¿€æ´»æ—¥å¿—)
CREATE TABLE activation_logs (
    id INTEGER PRIMARY KEY,
    license_key TEXT,
    hwid TEXT,
    action TEXT,                -- activate, heartbeat, deactivate
    ip_address TEXT,
    user_agent TEXT,
    success BOOLEAN,
    error_msg TEXT,
    created_at DATETIME
);
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒå¿…åš**:
   - âœ… å¯ç”¨ HTTPS
   - âœ… ä¿®æ”¹é»˜è®¤ç™»å½•å¯†ç 
   - âœ… å®ç°åç«¯ Token éªŒè¯
   - âœ… æ·»åŠ  IP ç™½åå•
   - âœ… å®šæœŸå¤‡ä»½æ•°æ®åº“

2. **å¯é€‰å¢å¼º**:
   - æ·»åŠ éªŒè¯ç é˜²æš´åŠ›ç ´è§£
   - å®ç° JWT è®¤è¯
   - æ·»åŠ æ“ä½œæ—¥å¿—å®¡è®¡
   - è®¾ç½® API è®¿é—®é¢‘ç‡é™åˆ¶

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®åº“?

```bash
# è‡ªåŠ¨å¤‡ä»½è„šæœ¬
cp licenses.db "licenses_backup_$(date +%Y%m%d_%H%M%S).db"
```

### Q: å¦‚ä½•é‡ç½®ç®¡ç†å‘˜å¯†ç ?

ç¼–è¾‘ `frontend/login.html` ä¸­çš„ `validUsers` å¯¹è±¡

### Q: å¦‚ä½•æŸ¥çœ‹æ—¥å¿—?

```bash
tail -f server.log
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ç®¡ç†å‘˜?

ç›®å‰æ˜¯å‰ç«¯ç®€å•éªŒè¯,ä¿®æ”¹ `login.html`:
```javascript
const validUsers = {
    'admin1': 'password1',
    'admin2': 'password2'
};
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- GitHub ä»“åº“: https://github.com/Lazywords2006/web
- é—®é¢˜åé¦ˆ: GitHub Issues
- æ–‡æ¡£æ›´æ–°: 2025-12-13

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°
- [x] è®¸å¯è¯ç”Ÿæˆ (æ”¯æŒè‡ªå®šä¹‰å¯†é’¥å’Œéšæœºç”Ÿæˆ)
- [x] è®¸å¯è¯æ¿€æ´»/éªŒè¯
- [x] è®¾å¤‡ç»‘å®š (æ”¯æŒå¤šè®¾å¤‡)
- [x] è¿‡æœŸæ—¶é—´ç®¡ç†
- [x] çŠ¶æ€ç®¡ç† (æ¿€æ´»/å°ç¦/è¿‡æœŸ)
- [x] **å¢åŠ è®¸å¯è¯æ—¶é•¿** (æœ¬æ¬¡æ–°å¢)
- [x] åˆ é™¤è®¸å¯è¯
- [x] ç»Ÿè®¡ä»ªè¡¨ç›˜
- [x] æ¿€æ´»æ—¥å¿—è®°å½•
- [x] Web ç®¡ç†ç•Œé¢
- [x] ç™»å½•è®¤è¯ç³»ç»Ÿ

### ğŸš§ è®¡åˆ’ä¸­
- [ ] åç«¯ JWT è®¤è¯
- [ ] é‚®ä»¶é€šçŸ¥
- [ ] è®¸å¯è¯å¯¼å‡º/å¯¼å…¥
- [ ] æ‰¹é‡æ“ä½œ
- [ ] é«˜çº§ç»Ÿè®¡æŠ¥è¡¨

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.2.0 (2025-12-13)
- âœ… ä¿®å¤: è·å–è®¸å¯è¯æ—¶çš„æ•°æ®åº“ NULL å€¼å¤„ç†
- âœ… æ–°å¢: å¢åŠ è®¸å¯è¯æ—¶é•¿åŠŸèƒ½
- âœ… æ–°å¢: åˆ é™¤è®¸å¯è¯åŠŸèƒ½
- âœ… ä¼˜åŒ–: å‰ç«¯å­—æ®µå…¼å®¹æ€§å¤„ç†

### v1.1.0 (2025-12-12)
- âœ… æ–°å¢: Web ç®¡ç†åå°ç•Œé¢
- âœ… æ–°å¢: ç™»å½•è®¤è¯ç³»ç»Ÿ
- âœ… æ–°å¢: ç»Ÿè®¡ä»ªè¡¨ç›˜

### v1.0.0 (2025-12-11)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… åŸºç¡€è®¸å¯è¯ CRUD åŠŸèƒ½
- âœ… è®¾å¤‡æ¿€æ´»ç®¡ç†
