# ç¨‹åºåŒ…è£…å™¨ä½¿ç”¨è¯´æ˜

## ğŸ“¦ æ–¹æ¡ˆè¯´æ˜

å½“æ‚¨æ— æ³•ä¿®æ”¹åŸç¨‹åºæºä»£ç æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª**å¯åŠ¨å™¨åŒ…è£…å™¨**æ¥å®ç°è®¸å¯è¯éªŒè¯ã€‚

### å·¥ä½œåŸç†

```
ç”¨æˆ·åŒå‡»å¯åŠ¨å™¨ â†’ éªŒè¯è®¸å¯è¯ â†’ å¯åŠ¨çœŸæ­£çš„ç¨‹åº
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ–‡ä»¶å‡†å¤‡

å°†ä»¥ä¸‹æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼š
```
é¡¹ç›®æ–‡ä»¶å¤¹/
â”œâ”€â”€ launcher_wrapper.py      # å¯åŠ¨å™¨ï¼ˆéªŒè¯ç¨‹åºï¼‰
â”œâ”€â”€ lzy_zte_12.10.exe        # æ‚¨çš„åŸç¨‹åº
â””â”€â”€ license.dat              # è®¸å¯è¯ä¿¡æ¯ï¼ˆé¦–æ¬¡æ¿€æ´»åè‡ªåŠ¨ç”Ÿæˆï¼‰
```

### 2. å¯åŠ¨è®¸å¯è¯æœåŠ¡å™¨

```bash
cd server
./server
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:8080` è¿è¡Œã€‚

### 3. è¿è¡Œå¯åŠ¨å™¨

**Windows ç”¨æˆ·:**
```bash
python launcher_wrapper.py
```

**macOS/Linux ç”¨æˆ·:**
```bash
/usr/bin/python3 launcher_wrapper.py
```

### 4. æ¿€æ´»è®¸å¯è¯

1. åœ¨å¼¹å‡ºçš„çª—å£ä¸­è¾“å…¥è®¸å¯è¯å¯†é’¥
2. ç‚¹å‡»"æ¿€æ´»å¹¶å¯åŠ¨ç¨‹åº"
3. éªŒè¯æˆåŠŸåä¼šè‡ªåŠ¨å¯åŠ¨ `lzy_zte_12.10.exe`

## ğŸ¨ å·¥ä½œæµç¨‹

### é¦–æ¬¡ä½¿ç”¨
```
1. ç”¨æˆ·è¿è¡Œ launcher_wrapper.py
2. æ˜¾ç¤ºè®¸å¯è¯è¾“å…¥ç•Œé¢
3. ç”¨æˆ·è¾“å…¥è®¸å¯è¯å¯†é’¥
4. è¿æ¥æœåŠ¡å™¨éªŒè¯è®¸å¯è¯
5. éªŒè¯æˆåŠŸ â†’ ä¿å­˜è®¸å¯è¯ä¿¡æ¯åˆ° license.dat
6. å¯åŠ¨ lzy_zte_12.10.exe
7. å¯åŠ¨å™¨è‡ªåŠ¨å…³é—­
```

### åç»­ä½¿ç”¨
```
1. ç”¨æˆ·è¿è¡Œ launcher_wrapper.py
2. è‡ªåŠ¨è¯»å– license.dat
3. éªŒè¯ç¡¬ä»¶IDæ˜¯å¦åŒ¹é…
4. åå°éªŒè¯è®¸å¯è¯æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
5. éªŒè¯é€šè¿‡ â†’ ç›´æ¥å¯åŠ¨ lzy_zte_12.10.exe
6. å¯åŠ¨å™¨è‡ªåŠ¨å…³é—­
```

## âš™ï¸ è‡ªå®šä¹‰é…ç½®

æ‰“å¼€ `launcher_wrapper.py`ï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

### ä¿®æ”¹æœåŠ¡å™¨åœ°å€ï¼ˆç¬¬ 22 è¡Œï¼‰
```python
self.server_url = "http://your-server.com:8080"  # æ”¹ä¸ºæ‚¨çš„æœåŠ¡å™¨åœ°å€
```

### ä¿®æ”¹ç›®æ ‡ç¨‹åºåç§°ï¼ˆç¬¬ 23 è¡Œï¼‰
```python
self.target_exe = "your_program.exe"  # æ”¹ä¸ºæ‚¨çš„ç¨‹åºåç§°
```

### ä¿®æ”¹çª—å£æ ‡é¢˜ï¼ˆç¬¬ 28 è¡Œï¼‰
```python
self.root.title("æ‚¨çš„ç¨‹åºåç§° - è®¸å¯è¯éªŒè¯")
```

### ä¿®æ”¹çª—å£å¤§å°ï¼ˆç¬¬ 29 è¡Œï¼‰
```python
self.root.geometry("500x350")  # å®½xé«˜
```

## ğŸ“¦ æ‰“åŒ…æˆ EXE

### å®‰è£… PyInstaller

```bash
pip install pyinstaller requests
```

### æ‰“åŒ…å‘½ä»¤

**Windows:**
```bash
pyinstaller --onefile ^
    --noconsole ^
    --name="ç¨‹åºå¯åŠ¨å™¨" ^
    --icon=your_icon.ico ^
    --add-data "lzy_zte_12.10.exe;." ^
    launcher_wrapper.py
```

**macOS/Linux:**
```bash
pyinstaller --onefile \
    --noconsole \
    --name="ç¨‹åºå¯åŠ¨å™¨" \
    --add-data "lzy_zte_12.10.exe:." \
    launcher_wrapper.py
```

### æ‰“åŒ…åçš„æ–‡ä»¶ç»“æ„

```
å‘å¸ƒæ–‡ä»¶å¤¹/
â”œâ”€â”€ ç¨‹åºå¯åŠ¨å™¨.exe          # ç»™ç”¨æˆ·çš„å¯åŠ¨å™¨
â””â”€â”€ lzy_zte_12.10.exe       # å†…åµŒçš„åŸç¨‹åº
```

ç”¨æˆ·åªéœ€è¦è¿è¡Œ `ç¨‹åºå¯åŠ¨å™¨.exe` å³å¯ã€‚

## ğŸ”’ å®‰å…¨å¢å¼º

### 1. åŠ å¯†è®¸å¯è¯æ–‡ä»¶

ä¿®æ”¹ `license.dat` çš„ä¿å­˜æ–¹å¼ï¼Œä½¿ç”¨åŠ å¯†ï¼š

```python
import base64
import json

def save_license(key, hwid):
    data = json.dumps({'key': key, 'hwid': hwid})
    encrypted = base64.b64encode(data.encode()).decode()
    with open(self.license_file, 'w') as f:
        f.write(encrypted)

def load_license():
    with open(self.license_file, 'r') as f:
        encrypted = f.read()
        decrypted = base64.b64decode(encrypted).decode()
        return json.loads(decrypted)
```

### 2. æ·»åŠ å¿ƒè·³ç›‘æ§

åœ¨å¯åŠ¨ç¨‹åºåï¼Œç»§ç»­è¿è¡Œå¯åŠ¨å™¨åœ¨åå°ç›‘æ§è®¸å¯è¯çŠ¶æ€ï¼š

```python
def launch_program(self):
    # å¯åŠ¨ç¨‹åº
    process = subprocess.Popen([self.target_exe])

    # åå°å¿ƒè·³ç›‘æ§
    threading.Thread(
        target=self.heartbeat_monitor,
        args=(process,),
        daemon=True
    ).start()

def heartbeat_monitor(self, process):
    while process.poll() is None:  # ç¨‹åºè¿˜åœ¨è¿è¡Œ
        time.sleep(30)  # æ¯30ç§’
        if not self.send_heartbeat():
            # å¿ƒè·³å¤±è´¥ï¼Œç»ˆæ­¢ç¨‹åº
            process.terminate()
            messagebox.showerror("è®¸å¯è¯å¤±æ•ˆ", "è®¸å¯è¯éªŒè¯å¤±è´¥ï¼Œç¨‹åºå°†å…³é—­")
            break
```

### 3. é˜²æ­¢ç›´æ¥è¿è¡ŒåŸç¨‹åº

å¯ä»¥å°† `lzy_zte_12.10.exe` æ”¹åä¸ºä¸æ˜“å¯Ÿè§‰çš„åç§°ï¼š

```python
self.target_exe = "_internal_app_core.exe"  # æ”¹ååçš„ç¨‹åº
```

æˆ–è€…ä½¿ç”¨æ›´å¤æ‚çš„æ–¹æ¡ˆï¼šå°†åŸç¨‹åºæ‰“åŒ…è¿›èµ„æºæ–‡ä»¶ï¼Œè¿è¡Œæ—¶è§£å¯†é‡Šæ”¾åˆ°ä¸´æ—¶ç›®å½•ã€‚

## ğŸŒ è¿œç¨‹æœåŠ¡å™¨é…ç½®

å¦‚æœæœåŠ¡å™¨éƒ¨ç½²åœ¨è¿œç¨‹ï¼š

```python
# ä¿®æ”¹æœåŠ¡å™¨åœ°å€
self.server_url = "https://your-domain.com"

# æ·»åŠ  HTTPS è¯ä¹¦éªŒè¯
response = requests.post(
    f"{self.server_url}/api/activate",
    json={"key": license_key, "hwid": self.hwid},
    timeout=10,
    verify=True  # éªŒè¯ SSL è¯ä¹¦
)
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ— æ³•å¯åŠ¨åŸç¨‹åº

**åŸå› **: Wine æœªå®‰è£…æˆ–è·¯å¾„ä¸å¯¹

**è§£å†³**:
- Windows: ç›´æ¥è¿è¡Œ exe
- macOS/Linux: å®‰è£… Wine (`brew install wine` æˆ– `apt install wine`)

### é—®é¢˜ 2: è®¸å¯è¯éªŒè¯å¤±è´¥

**æ£€æŸ¥**:
1. è®¸å¯è¯æœåŠ¡å™¨æ˜¯å¦è¿è¡Œï¼Ÿ
2. æœåŠ¡å™¨åœ°å€æ˜¯å¦æ­£ç¡®ï¼Ÿ
3. ç½‘ç»œæ˜¯å¦é€šç•…ï¼Ÿ
4. è®¸å¯è¯å¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Ÿ

### é—®é¢˜ 3: macOS Tkinter å´©æºƒ

**è§£å†³**: ä½¿ç”¨ç³»ç»Ÿ Python
```bash
/usr/bin/python3 launcher_wrapper.py
```

## ğŸ“Š æµ‹è¯•æµç¨‹

### 1. æœ¬åœ°æµ‹è¯•

```bash
# ç»ˆç«¯ 1: å¯åŠ¨æœåŠ¡å™¨
cd server
./server

# ç»ˆç«¯ 2: è¿è¡Œå¯åŠ¨å™¨
python launcher_wrapper.py
```

### 2. æµ‹è¯•åœºæ™¯

- âœ… é¦–æ¬¡æ¿€æ´»
- âœ… ä½¿ç”¨é”™è¯¯çš„å¯†é’¥
- âœ… ä½¿ç”¨å·²æ¿€æ´»çš„å¯†é’¥
- âœ… å†æ¬¡è¿è¡Œï¼ˆè‡ªåŠ¨éªŒè¯ï¼‰
- âœ… åˆ é™¤ license.dat åé‡æ–°æ¿€æ´»
- âœ… ä¿®æ”¹ license.dat ä¸­çš„ç¡¬ä»¶IDï¼ˆåº”è¯¥å¤±è´¥ï¼‰

## ğŸ’¡ é«˜çº§ç”¨æ³•

### æ·»åŠ è‡ªå®šä¹‰ç•Œé¢

å¯ä»¥ä½¿ç”¨ `tkinter` æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼š
- äº§å“ä¿¡æ¯å±•ç¤º
- ä½¿ç”¨æ¡æ¬¾åŒæ„
- åœ¨çº¿æ›´æ–°æ£€æŸ¥
- ç”¨æˆ·æ³¨å†Œ
- å‰©ä½™å¤©æ•°æ˜¾ç¤º

### ç¤ºä¾‹ï¼šæ˜¾ç¤ºå‰©ä½™å¤©æ•°

```python
def check_saved_license(self):
    # ... åŸæœ‰ä»£ç  ...

    # è·å–è®¸å¯è¯è¯¦æƒ…
    response = requests.get(
        f"{self.server_url}/api/license-info",
        params={"key": license_key}
    )

    if response.status_code == 200:
        data = response.json()
        expires_at = data.get('expires_at')
        # è®¡ç®—å‰©ä½™å¤©æ•°
        from datetime import datetime
        exp_date = datetime.fromisoformat(expires_at)
        days_left = (exp_date - datetime.now()).days

        self.status_label.config(
            text=f"è®¸å¯è¯æœ‰æ•ˆï¼Œå‰©ä½™ {days_left} å¤©",
            fg="green"
        )
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸»é¡¹ç›®æ–‡æ¡£](../README.md)
- [é›†æˆåˆ°EXEçš„å®Œæ•´æŒ‡å—](./é›†æˆåˆ°EXEçš„å®Œæ•´æŒ‡å—.md)
- [Python GUI ä½¿ç”¨è¯´æ˜](./Python_GUI_ä½¿ç”¨è¯´æ˜.md)

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•**: å®Œæ•´æµ‹è¯•å¯åŠ¨å™¨çš„å„ç§åœºæ™¯
2. **è‡ªå®šä¹‰**: æ ¹æ®éœ€è¦ä¿®æ”¹ç•Œé¢å’Œé€»è¾‘
3. **æ‰“åŒ…**: ä½¿ç”¨ PyInstaller æ‰“åŒ…æˆ exe
4. **éƒ¨ç½²**: å°†æœåŠ¡å™¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
5. **åˆ†å‘**: å°†å¯åŠ¨å™¨åˆ†å‘ç»™ç”¨æˆ·

---

å¦‚æœæ‚¨æœ‰æºä»£ç å¹¶å¸Œæœ›ç›´æ¥é›†æˆåˆ°ç¨‹åºä¸­ï¼Œè¯·å‚è€ƒ [é›†æˆåˆ°EXEçš„å®Œæ•´æŒ‡å—](./é›†æˆåˆ°EXEçš„å®Œæ•´æŒ‡å—.md)ã€‚
