# é›†æˆç¤ºä¾‹é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºå¦‚ä½•å°†è®¸å¯è¯ç®¡ç†ç³»ç»Ÿé›†æˆåˆ°ä½ çš„é¡¹ç›®ä¸­çš„ç¤ºä¾‹ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
my-app/
â”œâ”€â”€ main.go                    # ä½ çš„ä¸»ç¨‹åº
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ license/                   # è®¸å¯è¯æ¨¡å— (é›†æˆçš„)
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ admin.go          # ç®¡ç† API
â”‚   â”‚   â””â”€â”€ license.go        # è®¸å¯è¯ API
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ models.go         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ db.go             # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ utils.go          # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ frontend/             # Web ç•Œé¢
â”‚       â”œâ”€â”€ login.html
â”‚       â”œâ”€â”€ index.html
â”‚       â””â”€â”€ test.html
â””â”€â”€ licenses.db               # SQLite æ•°æ®åº“
```

## ğŸš€ å®Œæ•´ç¤ºä¾‹ä»£ç 

### main.go (ç®€åŒ–ç‰ˆ)

```go
package main

import (
    "log"
    "net/http"

    // å¯¼å…¥è®¸å¯è¯æ¨¡å—
    "my-app/license/database"
    licenseHandlers "my-app/license/handlers"
)

func main() {
    // 1. åˆå§‹åŒ–è®¸å¯è¯æ•°æ®åº“
    log.Println("åˆå§‹åŒ–è®¸å¯è¯ç³»ç»Ÿ...")
    if err := database.InitDB("./licenses.db"); err != nil {
        log.Fatalf("æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥: %v", err)
    }
    defer database.Close()

    // 2. ä½ çš„åº”ç”¨è·¯ç”±
    http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
        w.Write([]byte("æ¬¢è¿ä½¿ç”¨æˆ‘çš„åº”ç”¨!"))
    })

    // 3. æ·»åŠ è®¸å¯è¯ API è·¯ç”±
    registerLicenseRoutes()

    // 4. å¯åŠ¨æœåŠ¡å™¨
    log.Println("æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080")
    log.Println("ç®¡ç†ç•Œé¢: http://localhost:8080/license/login.html")
    if err := http.ListenAndServe(":8080", nil); err != nil {
        log.Fatal(err)
    }
}

// æ³¨å†Œè®¸å¯è¯ç›¸å…³è·¯ç”±
func registerLicenseRoutes() {
    // å®¢æˆ·ç«¯ API (ä¾›ä½ çš„åº”ç”¨è°ƒç”¨)
    http.HandleFunc("/api/activate", licenseHandlers.HandleActivate)
    http.HandleFunc("/api/heartbeat", licenseHandlers.HandleHeartbeat)

    // ç®¡ç† API
    http.HandleFunc("/api/admin/license", handleAdminLicense)
    http.HandleFunc("/api/admin/licenses", licenseHandlers.HandleListLicenses)
    http.HandleFunc("/api/admin/stats", licenseHandlers.HandleGetStats)

    // å‰ç«¯é™æ€æ–‡ä»¶
    fs := http.FileServer(http.Dir("./license/frontend"))
    http.Handle("/license/", http.StripPrefix("/license/", fs))
}

// ç»Ÿä¸€å¤„ç†ç®¡ç† API çš„ä¸åŒ HTTP æ–¹æ³•
func handleAdminLicense(w http.ResponseWriter, r *http.Request) {
    switch r.Method {
    case http.MethodPost:
        licenseHandlers.HandleGenerateLicense(w, r)
    case http.MethodGet:
        licenseHandlers.HandleGetLicense(w, r)
    case http.MethodPut:
        licenseHandlers.HandleUpdateLicense(w, r)
    case http.MethodDelete:
        licenseHandlers.HandleDeleteLicense(w, r)
    default:
        http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
    }
}
```

### go.mod

```go
module my-app

go 1.21

require github.com/mattn/go-sqlite3 v1.14.18
```

## ğŸ”§ ä½¿ç”¨å¿«é€Ÿé›†æˆè„šæœ¬

### æ–¹å¼ 1: å®Œæ•´ç‹¬ç«‹éƒ¨ç½²

```bash
# åˆ›å»ºæ–°ç›®å½•å¹¶éƒ¨ç½²
./å¿«é€Ÿé›†æˆ.sh ~/Desktop/LicenseServer

# è¿›å…¥ç›®å½•å¹¶è¿è¡Œ
cd ~/Desktop/LicenseServer/server
./server
```

### æ–¹å¼ 2: é›†æˆåˆ°ç°æœ‰é¡¹ç›®

```bash
# å‡è®¾ä½ çš„é¡¹ç›®åœ¨ ~/my-app
./å¿«é€Ÿé›†æˆ.sh ~/my-app

# ç„¶åä¿®æ”¹ä½ çš„ main.go (å‚è€ƒä¸Šé¢çš„ç¤ºä¾‹)
```

### æ–¹å¼ 3: æ‰‹åŠ¨é›†æˆ

```bash
# 1. å¤åˆ¶æ–‡ä»¶
cd /path/to/your/project
mkdir -p license/{handlers,models,database,utils,frontend}

# 2. å¤åˆ¶ä»£ç 
cp /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/handlers/*.go license/handlers/
cp /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/models/*.go license/models/
cp /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/database/*.go license/database/
cp /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/utils/*.go license/utils/
cp -r /Users/lazywords/Documents/ç½‘ç»œéªŒè¯/server/frontend/* license/frontend/

# 3. å®‰è£…ä¾èµ–
go get github.com/mattn/go-sqlite3
go mod tidy

# 4. ä¿®æ”¹ä½ çš„ main.go (å‚è€ƒä¸Šé¢çš„ç¤ºä¾‹ä»£ç )

# 5. è¿è¡Œ
go run main.go
```

## ğŸ“ ä½¿ç”¨æµç¨‹

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
go run main.go
```

### 2. è®¿é—®ç®¡ç†åå°

```
http://localhost:8080/license/login.html
ç”¨æˆ·å: lazywords
å¯†ç : w7168855
```

### 3. ç”Ÿæˆè®¸å¯è¯

åœ¨ç®¡ç†åå°ç‚¹å‡» "ç”Ÿæˆè®¸å¯è¯":
- è®¸å¯è¯å¯†é’¥: LICENSE-2025-TEST (æˆ–éšæœºç”Ÿæˆ)
- æœ€å¤§è®¾å¤‡æ•°: 3
- è¿‡æœŸæ—¶é—´: é€‰æ‹©æ—¥æœŸ
- å¤‡æ³¨: æµ‹è¯•è®¸å¯è¯

### 4. åœ¨ä½ çš„å®¢æˆ·ç«¯åº”ç”¨ä¸­ä½¿ç”¨

```go
// ç¤ºä¾‹: Go å®¢æˆ·ç«¯æ¿€æ´»
import (
    "bytes"
    "encoding/json"
    "net/http"
)

func activateLicense(key, hwid string) error {
    data := map[string]string{
        "license_key": key,
        "hwid":        hwid,
    }

    jsonData, _ := json.Marshal(data)
    resp, err := http.Post(
        "http://localhost:8080/api/activate",
        "application/json",
        bytes.NewBuffer(jsonData),
    )

    if err != nil {
        return err
    }
    defer resp.Body.Close()

    var result map[string]interface{}
    json.NewDecoder(resp.Body).Decode(&result)

    if result["success"].(bool) {
        log.Println("è®¸å¯è¯æ¿€æ´»æˆåŠŸ!")
        return nil
    }

    return fmt.Errorf("æ¿€æ´»å¤±è´¥: %v", result["error"])
}
```

## ğŸ¯ å¸¸è§é›†æˆåœºæ™¯

### åœºæ™¯ A: æ¡Œé¢åº”ç”¨è½¯ä»¶

```
ä½ çš„æ¡Œé¢åº”ç”¨ (C#/C++/Python)
       â†“ HTTP è¯·æ±‚
è®¸å¯è¯æœåŠ¡å™¨ (Go)
       â†“ æ•°æ®å­˜å‚¨
  SQLite æ•°æ®åº“
```

**éƒ¨ç½²**: æœåŠ¡å™¨ç‹¬ç«‹è¿è¡Œ,åº”ç”¨é€šè¿‡ API éªŒè¯

### åœºæ™¯ B: Web åº”ç”¨

```
å‰ç«¯ (React/Vue)
       â†“
åç«¯ (Go) + è®¸å¯è¯æ¨¡å—
       â†“
  PostgreSQL/MySQL
```

**é›†æˆ**: è®¸å¯è¯æ¨¡å—ç›´æ¥é›†æˆåˆ°åç«¯ä»£ç 

### åœºæ™¯ C: å¾®æœåŠ¡æ¶æ„

```
å„ä¸ªå¾®æœåŠ¡
       â†“ gRPC/HTTP
è®¸å¯è¯æœåŠ¡ (ç‹¬ç«‹æœåŠ¡)
       â†“
  æ•°æ®åº“é›†ç¾¤
```

**éƒ¨ç½²**: è®¸å¯è¯ç³»ç»Ÿä½œä¸ºç‹¬ç«‹å¾®æœåŠ¡

## ğŸ“Š API å¿«é€Ÿå‚è€ƒ

### å®¢æˆ·ç«¯ API

```bash
# æ¿€æ´»è®¸å¯è¯
POST /api/activate
{
    "license_key": "LICENSE-2025-XXX",
    "hwid": "unique-device-id"
}

# å¿ƒè·³éªŒè¯
POST /api/heartbeat
{
    "license_key": "LICENSE-2025-XXX",
    "hwid": "unique-device-id"
}
```

### ç®¡ç† API

```bash
# ç”Ÿæˆè®¸å¯è¯
POST /api/admin/license
{
    "key": "LICENSE-2025-XXX",
    "max_devices": 3,
    "expiry_date": "2026-01-01T00:00:00Z"
}

# è·å–åˆ—è¡¨
GET /api/admin/licenses

# è·å–è¯¦æƒ…
GET /api/admin/license?key=LICENSE-2025-XXX

# æ›´æ–°è®¸å¯è¯
PUT /api/admin/license
{
    "key": "LICENSE-2025-XXX",
    "expiry_date": "2027-01-01T00:00:00Z"
}

# åˆ é™¤è®¸å¯è¯
DELETE /api/admin/license?key=LICENSE-2025-XXX

# ç»Ÿè®¡æ•°æ®
GET /api/admin/stats
```

## ğŸ” å®‰å…¨å»ºè®®

### å¼€å‘ç¯å¢ƒ
- âœ… ä½¿ç”¨é»˜è®¤é…ç½®å¿«é€Ÿå¼€å‘
- âœ… HTTP å³å¯

### ç”Ÿäº§ç¯å¢ƒ
- âš ï¸ å¿…é¡»å¯ç”¨ HTTPS
- âš ï¸ ä¿®æ”¹ç™»å½•å¯†ç 
- âš ï¸ å®ç°åç«¯ Token è®¤è¯
- âš ï¸ æ·»åŠ è®¿é—®é¢‘ç‡é™åˆ¶
- âš ï¸ å®šæœŸå¤‡ä»½æ•°æ®åº“

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8080

# åœæ­¢è¿›ç¨‹
kill -9 <PID>

# æˆ–è€…ä¿®æ”¹ç«¯å£
http.ListenAndServe(":9000", nil)
```

### é—®é¢˜ 2: æ•°æ®åº“æƒé™é”™è¯¯

```bash
# ç¡®ä¿æ•°æ®åº“æ–‡ä»¶æœ‰è¯»å†™æƒé™
chmod 644 licenses.db
```

### é—®é¢˜ 3: ä¾èµ–å®‰è£…å¤±è´¥

```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…
go clean -modcache
go mod tidy
go get github.com/mattn/go-sqlite3
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´ API æ–‡æ¡£](../README.md)
- [è¯¦ç»†é›†æˆæŒ‡å—](../é›†æˆæŒ‡å—.md)
- [éƒ¨ç½²æ–‡æ¡£](../DEPLOYMENT.md)

## ğŸ’¡ æç¤º

1. **å¼€å‘æ—¶**: ä½¿ç”¨ `go run main.go` å¿«é€Ÿæµ‹è¯•
2. **ç”Ÿäº§æ—¶**: ä½¿ç”¨ `go build` ç¼–è¯‘åéƒ¨ç½²
3. **è°ƒè¯•æ—¶**: æŸ¥çœ‹ `server.log` æ—¥å¿—æ–‡ä»¶
4. **å¤‡ä»½æ—¶**: å®šæœŸå¤‡ä»½ `licenses.db` æ–‡ä»¶

## âœ¨ ä¸‹ä¸€æ­¥

- [ ] ä¿®æ”¹ç™»å½•å¯†ç 
- [ ] ç”Ÿæˆæµ‹è¯•è®¸å¯è¯
- [ ] åœ¨å®¢æˆ·ç«¯é›†æˆ API
- [ ] é…ç½® HTTPS (ç”Ÿäº§ç¯å¢ƒ)
- [ ] è®¾ç½®è‡ªåŠ¨å¤‡ä»½

---

**éœ€è¦å¸®åŠ©?** æŸ¥çœ‹ [é›†æˆæŒ‡å—.md](../é›†æˆæŒ‡å—.md) è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
